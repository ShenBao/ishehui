<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ISH</title>
        
    <link rel="stylesheet" type="text/css" href="../../static/css/main.css">
</head>
<body>
<div class="navbar navbar-line">
    <div class="container">
        <div class="logo">
            
                ISH
            
        </div>
        <input type="checkbox" id="idoc_nav" />
        <div class="menu_tree">
        <ul><li><a href="../../index.html">首页</a></li><li><a href="#"><span></span>JS</a><ul><li><a href="../../html/JS/快速搞定常用的ES6新特性.html">快速搞定常用的ES6新特性</a></li><li class="active"><a href="../../html/JS/H5页面与Native的交互 封装使用.html">H5页面与Native的交互 封装使用</a></li></ul></li><li><a href="#"><span></span>React</a><ul><li><a href="../../html/React/React API 汇总.html">React API 汇总</a></li><li><a href="../../html/React/React中ES6与ES5构建差别及JSX的使用.html">React中ES6与ES5构建差别及JSX的使用</a></li><li><a href="../../html/React/React基础知识.html">React基础知识</a></li><li><a href="../../html/React/React编码规范.html">React编码规范</a></li><li><a href="../../html/React/webpack搭配react入门及实践.html">webpack搭配react入门及实践</a></li></ul></li><li><a href="#"><span></span>RN 基础</a><ul><li><a href="../../html/RN 基础/ReactNative学习提纲.html">ReactNative学习提纲</a></li><li><a href="../../html/RN 基础/ReactNative 命令汇总.html">ReactNative 命令汇总</a></li><li><a href="../../html/RN 基础/初探React-Native.html">初探React-Native</a></li><li><a href="../../html/RN 基础/React-Native样式表指南.html">React-Native样式表指南</a></li><li><a href="../../html/RN 基础/ReactNative 布局之FlexBox.html">ReactNative 布局之FlexBox</a></li><li><a href="../../html/RN 基础/React Native 基础之Props(属性)与State(状态).html">React Native 基础之Props(属性)与State(状态)</a></li><li><a href="../../html/RN 基础/React Native基础之核心组件使用教程介绍.html">React Native基础之核心组件使用教程介绍</a></li><li><a href="../../html/RN 基础/WebStorm开发工具设置React Native代码智能提醒.html">WebStorm开发工具设置React Native代码智能提醒</a></li></ul></li><li><a href="#"><span></span>RN API</a><ul><li><a href="../../html/RN API/React Native API模块 之 Alert .html">React Native API模块 之 Alert </a></li><li><a href="../../html/RN API/React Native API模块 之 Dimensions.html">React Native API模块 之 Dimensions</a></li><li><a href="../../html/RN API/React Native API模块 之 Keyboard.html">React Native API模块 之 Keyboard</a></li><li><a href="../../html/RN API/React Native API模块 之 StyleSheet.html">React Native API模块 之 StyleSheet</a></li><li><a href="../../html/RN API/React Native API模块 之 ToastAndroid.html">React Native API模块 之 ToastAndroid</a></li></ul></li><li><a href="#"><span></span>RN 组件</a><ul><li><a href="../../html/RN 组件/RN组件 之 Text 及注意要点 .html">RN组件 之 Text 及注意要点 </a></li><li><a href="../../html/RN 组件/RN组件 之 TextInput 及注意要点.html">RN组件 之 TextInput 及注意要点</a></li><li><a href="../../html/RN 组件/React Native控件之Touchable X 系列组件.html">React Native控件之Touchable X 系列组件</a></li></ul></li><li><a href="#"><span></span>RN 工具</a><ul><li><a href="../../html/RN 工具/基于Fetch封装HTTPUtil工具类.html">基于Fetch封装HTTPUtil工具类</a></li></ul></li><li><a href="#"><span></span>开发</a><ul><li><a href="../../html/开发/RN版  bug反馈列表(rn 0.35).html">RN版  bug反馈列表(rn 0.35)</a></li><li><a href="../../html/开发/RN版  项目重构(基于RN 0.41.2).html">RN版  项目重构(基于RN 0.41.2)</a></li></ul></li><li><a href="../../html/关于.html">关于</a></li></ul>    
        </div>
        
        

        <section class="idoc_nav_btn">
            <label for="idoc_nav"><span></span></label>
        </section>
    </div>
    
</div>




<div class="container">

    <div class="page-toc">
        <ul><li><a href="#t0H5页面与Native的交互">H5页面与Native的交互</a><ul><li><a href="#t1旧版本">旧版本</a></li><li><a href="#t2以后新版">以后新版</a></li><li><a href="#t3附件">附件</a><ul><li><a href="#t4js_callnative.js封装的NativeCall的方法">js_callnative.js封装的NativeCall的方法</a></li><li><a href="#t5使用方法：">使用方法：</a><ul><li><a href="#t6一：兼容老模式">一：兼容老模式</a></li><li><a href="#t7二．新模式">二．新模式</a></li></ul></li></ul></li><li><a href="#t8附执行原理：">附执行原理：</a></li></ul></li></ul>
    </div>
    
    <div class="content markdown-body">
        <h1 id="t0H5&#x9875;&#x9762;&#x4E0E;Native&#x7684;&#x4EA4;&#x4E92;">H5&#x9875;&#x9762;&#x4E0E;Native&#x7684;&#x4EA4;&#x4E92; <a href="#t0H5&#x9875;&#x9762;&#x4E0E;Native&#x7684;&#x4EA4;&#x4E92;"> # </a></h1>
<h2 id="t1&#x65E7;&#x7248;&#x672C;">&#x65E7;&#x7248;&#x672C; <a href="#t1&#x65E7;&#x7248;&#x672C;"> # </a></h2>
<p>&#xFF08;&#x7528;&#x6CD5;&#x53C2;&#x8003;&#x9644;&#x4EF6;  &#x517C;&#x5BB9;&#x8001;&#x6A21;&#x5F0F;&#xFF09;</p>
<table>
<thead>
<tr>
<th>&#x529F;&#x80FD;</th>
<th>&#x63CF;&#x8FF0;</th>
<th>Data</th>
</tr>
</thead>
<tbody>
<tr>
<td>&#x8F6E;&#x64AD;&#x56FE;&#xFF1A;</td>
<td>FTPosterJump</td>
<td>json</td>
</tr>
<tr>
<td>&#x5934;&#x50CF;&#xFF1A;</td>
<td>FTPresentH5</td>
<td>url</td>
</tr>
<tr>
<td>&#x697C;&#x5C42;&#xFF1A;</td>
<td>FTCardOperation</td>
<td>json</td>
</tr>
<tr>
<td>&#x5927;&#x56FE;&#xFF1A;</td>
<td>FTPhotoBrowse</td>
<td>jsond&#x5E26;&#x6709;url&#x548C;&#x56FE;&#x7247;&#x7C7B;&#x578B;</td>
</tr>
<tr>
<td>&#x8BE6;&#x60C5;&#xFF1A;</td>
<td>FTPresent101DetailH5</td>
<td>json</td>
</tr>
<tr>
<td>&#x70B9;&#x8D5E;&#x672A;&#x767B;&#x5F55;&#xFF1A;</td>
<td>FTLaudCard</td>
<td>{}                &#xFF08;&#x56DE;&#x8C03;H5&#x7684; loginCallback&#x65B9;&#x6CD5;&#x5E26;uid&#xFF0C;token&#xFF09;</td>
</tr>
<tr>
<td>&#x8BC4;&#x8BBA;&#xFF1A;</td>
<td>FTPresentH5</td>
<td>json&#x4E2D;&#x5E26;url</td>
</tr>
<tr>
<td>&#x5206;&#x4EAB;&#xFF1A;</td>
<td>FTShareCard</td>
<td>json</td>
</tr>
</tbody>
</table>
<h2 id="t2&#x4EE5;&#x540E;&#x65B0;&#x7248;">&#x4EE5;&#x540E;&#x65B0;&#x7248; <a href="#t2&#x4EE5;&#x540E;&#x65B0;&#x7248;"> # </a></h2>
<p>&#xFF08;&#x7528;&#x6CD5;&#x53C2;&#x8003;&#x9644;&#x4EF6;  &#x65B0;&#x6A21;&#x5F0F;&#xFF09;</p>
<table>
<thead>
<tr>
<th>&#x529F;&#x80FD;</th>
<th>&#x63CF;&#x8FF0;</th>
<th>Data</th>
</tr>
</thead>
<tbody>
<tr>
<td>&#x6D4B;&#x8BD5;&#xFF1A;</td>
<td>key_persent_test</td>
<td>json                     &#x5728;&#x56DE;&#x8C03;&#x4E2D;&#x8FD4;&#x56DE;&#x4E00;&#x4E2A;json&#xFF0C;&#x4F20;&#x5165;response</td>
</tr>
<tr>
<td>Alert&#xFF1A;</td>
<td>key_persent_alert</td>
<td>{message : &apos;alert&#x6D4B;&#x8BD5;&apos;};</td>
</tr>
<tr>
<td>Toast&#xFF1A;</td>
<td>key_persent_toast</td>
<td>{message : toast&#x6D4B;&#x8BD5;&apos;};</td>
</tr>
</tbody>
</table>
<h2 id="t3&#x9644;&#x4EF6;">&#x9644;&#x4EF6; <a href="#t3&#x9644;&#x4EF6;"> # </a></h2>
<h3 id="t4js_callnative.js&#x5C01;&#x88C5;&#x7684;NativeCall&#x7684;&#x65B9;&#x6CD5;">js_callnative.js&#x5C01;&#x88C5;&#x7684;NativeCall&#x7684;&#x65B9;&#x6CD5; <a href="#t4js_callnative.js&#x5C01;&#x88C5;&#x7684;NativeCall&#x7684;&#x65B9;&#x6CD5;"> # </a></h3>
<pre><code>function NativeCall() {};
(function() {
    var userAgent = navigator.userAgent;
    NativeCall.isAndroid = userAgent.indexOf(&apos;Android&apos;) &gt; -1 || userAgent.indexOf(&apos;Linux&apos;) &gt; -1;
    NativeCall.isIOS = !!userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);
    function toFunction(callback) {
        var callbackType = typeof callback;
        if (callbackType == &quot;string&quot;) {
            //&#x5982;&#x679C;&#x56DE;&#x8C03;&#x65B9;&#x6CD5;&#x5199;&#x7684;&#x662F;&#x65B9;&#x6CD5;&#x540D;&#x5B57;&#x7B26;&#x4E32;&#xFF0C;&#x8F6C;&#x6210;&#x65B9;&#x6CD5;
            return callback.startsWith(&quot;window.&quot;) ? eval(callback) : eval(&quot;window.&quot; + callback);
        }
        return callback;
    }
    function processDebug(debug, callback) {
        if (!debug) {
            return false;
        }
        var type = typeof debug;
        var response;
        //&#x5904;&#x7406;&#x662F;&#x5426;&#x4E3A;&#x51FD;&#x6570;&#x5F0F;Debug
        if (type == &quot;function&quot;) {
            response = debug();
        } else {
            response = debug;
        }
        //&#x5904;&#x7406;&#x8FD4;&#x56DE;&#x7684;&#x6570;&#x636E;
        var method;
        if (response instanceof Array) {
            //&#x5982;&#x679C;&#x662F;&#x6570;&#x636E;&#x5219;&#x591A;&#x53C2;&#x6570;&#x8C03;&#x7528;&#xFF0C;&#x591A;&#x4E2A;&#x53C2;&#x6570;
            method = &quot;apply&quot;;
        } else {
            //&#x53C2;&#x6570;&#x5217;&#x8868;&#xFF0C;&#x53EA;&#x4E00;&#x4E2A;&#x53C2;&#x6570;
            method = &quot;call&quot;;
        }
        toFunction(callback)[method](this, response);
        return true;
    }
    /**
     * @param  {String} message
     * @param  {Object} data
     * @param  {Function|String} callback
     * @param  {Object|Function} debug
     */
    NativeCall.sendOld = function(message, data, oldData, callback, debug) {
        sendOpt({
            &apos;message&apos;: message,
            &apos;data&apos;: data,
            &apos;oldData&apos;: oldData,
            &apos;callback&apos;: callback,
            &apos;debug&apos;: debug,
            &apos;version&apos;: 1
        });
    }
    /**
     * @param  {String|Object} message &#x5F53;&#x662F;Object&#x65F6;&#x540E;&#x9762;&#x53C2;&#x6570;&#x53EF;&#x4E0D;&#x4F20;
     * @param  {Object} data
     * @param  {Function|String} callback
     * @param  {Object|Function} debug
     */
    NativeCall.send = function() {
        if (arguments.length == 1) {
            sendOpt(arguments[0]);
        } else {
            sendOpt({
                &apos;message&apos;: arguments[0],
                &apos;data&apos;: arguments[1],
                &apos;callback&apos;: arguments[2],
                &apos;debug&apos;: arguments[3],
                &apos;version&apos;: 2
            });
        }
    }
    function sendOpt(opt) {
        var message = opt.message;
        var data = opt.data;
        var callback = opt.callback;
        var version = opt.version;
        //debug&#x65F6;
        if (processDebug(opt.debug, callback)) {
            return ;
        }
        //&#x6B63;&#x5F0F;&#x73AF;&#x5883;
        if (NativeCall.isAndroid) {
            if (version == 1) {
                //&#x517C;&#x5BB9;&#x4E4B;&#x524D;&#x8001;&#x6A21;&#x5F0F;
                var oldData = opt.oldData;
                var oldDataType = typeof oldData;
                if(oldDataType == &quot;object&quot;) {
                    JavaScriptInterface[message](JSON.stringify(oldData));
                } else {
                    JavaScriptInterface[message](oldData);
                }
            } else {
                //&#x65B0;&#x6A21;&#x5F0F;
                JavaScriptInterface.callHandler(message, JSON.stringify(data), &quot;&quot; + callback);
            }
        } else if (NativeCall.isIOS) {
            window.WebViewJavascriptBridge.callHandler(message, data, toFunction(callback));
        } else {
            alert(&apos;This platform is not available!&apos;);
            // console.log(message, JSON.stringify(data), &quot;&quot;+callback);
            // console.log(&apos;This platform is not available!&apos;);
        }
    }
})();
</code></pre><h3 id="t5&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#xFF1A;">&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#xFF1A; <a href="#t5&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#xFF1A;"> # </a></h3>
<h4 id="t6&#x4E00;&#xFF1A;&#x517C;&#x5BB9;&#x8001;&#x6A21;&#x5F0F;">&#x4E00;&#xFF1A;&#x517C;&#x5BB9;&#x8001;&#x6A21;&#x5F0F; <a href="#t6&#x4E00;&#xFF1A;&#x517C;&#x5BB9;&#x8001;&#x6A21;&#x5F0F;"> # </a></h4>
<p>&#x6CE8;&#x610F;&#xFF1A;&#x5728;&#x5B89;&#x5353;&#x7AEF;&#x9700;&#x8981;&#x77E5;&#x9053;H5&#x7684;&#x65B9;&#x6CD5;&#x540D;</p>
<pre><code>A.json
            NativeCall.sendOld(&quot;FTPosterJump&quot;, swiperList[index],  swiperList[index] , function(response) {
                &#x4E1A;&#x52A1;&#x4EE3;&#x7801;
            });
B.url
            NativeCall.sendOld( &quot;FTPosterJump&quot; , {&apos;url&apos;: _url} , url , function( response) {
                &#x4E1A;&#x52A1;&#x4EE3;&#x7801;
            });
</code></pre><h4 id="t7&#x4E8C;&#xFF0E;&#x65B0;&#x6A21;&#x5F0F;">&#x4E8C;&#xFF0E;&#x65B0;&#x6A21;&#x5F0F; <a href="#t7&#x4E8C;&#xFF0E;&#x65B0;&#x6A21;&#x5F0F;"> # </a></h4>
<pre><code>A.&#x5E26;&#x6709;Debug&#x65E0;&#x4E1A;&#x52A1;&#x64CD;&#x4F5C;
            NativeCall.send(&quot;login&quot;, data, callback, {
                uid: 1212,
                token: &quot;abc&quot;
            });
B. &#x5E26;&#x6709;Debug &#x4E14;&#x6709;&#x4E1A;&#x52A1;&#x64CD;&#x4F5C;
NativeCall.send(&quot;login&quot;, data, &apos;window.callback2&apos;, function() {
                console.log(&quot;&#x505A;&#x4E00;&#x4E9B;&#x6A21;&#x62DF;&#x64CD;&#x4F5C;&quot;);
                return {
                    uid: 1212,
                    token: &quot;abc&quot;
                };
            });
C.&#x58F0;&#x660E;&#x51FD;&#x6570;&#xFF08;&#x5927;&#x529B;&#x63D0;&#x5021;&#x4F7F;&#x7528;&#xFF09;
            NativeCall.send(&quot;login&quot;, data, &apos;callback2&apos;);
            NativeCall.send(&quot;login&quot;, data, callback2);
D.&#x533F;&#x540D;&#x51FD;&#x6570;&#xFF08;&#x4E0D;&#x63D0;&#x5021;&#x4F7F;&#x7528;&#xFF1B;&#x82E5;&#x5E94;&#x7528;&#xFF0C;&#x5219;&#x4E0D;&#x8981;&#x5728;&#x533F;&#x540D;&#x51FD;&#x6570;&#x4E2D;&#x5199;&#x6CE8;&#x91CA;&#x4E14;JS&#x8BED;&#x6CD5;&#x8981;&#x4E25;&#x683C;&#xFF09;
NativeCall.send(&quot;login&quot;, data, function() {
                console.log(obj.uid, obj.token);
            });
</code></pre><h2 id="t8&#x9644;&#x6267;&#x884C;&#x539F;&#x7406;&#xFF1A;">&#x9644;&#x6267;&#x884C;&#x539F;&#x7406;&#xFF1A; <a href="#t8&#x9644;&#x6267;&#x884C;&#x539F;&#x7406;&#xFF1A;"> # </a></h2>
<p>&#x5B9E;&#x9645;&#x662F;&#x5728;&#x6D4F;&#x89C8;&#x5668;&#x7684;url&#x4E2D;&#x8FD0;&#x884C;&#x4EE3;&#x7801;</p>
<pre><code>javascript:(function callback(obj) {
                console.log(obj.uid, obj.token);
            })({uid:111, token:&quot;xxx&quot;})

            javascript:(function (obj) {
                console.log(&apos;nnn&apos;);
                console.log(obj.uid, obj.token);
            })({uid:111, token:&quot;xxx&quot;});

            javascript:(callback)({uid:111, token:&quot;xxx&quot;})&#xFF1B;
</code></pre><p>[&#x5168;&#x6587;&#x5B8C;]</p>

        <div class="copyright">Created by <a href="https://github.com/shenbao" target="_blank">ShenBao</a></div>
    </div>

</div>


</body>
</html>
